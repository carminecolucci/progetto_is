\chapter{Modellazione dei Casi d'Uso}

\section{Attori e Casi d'Uso}

\paragraph{Attori primari}
\begin{itemize}
	\item Cliente
	\item Farmacista
	\item Direttore
	\item Cliente non registrato
\end{itemize}

\paragraph{Attori secondari}
\begin{itemize}
	\item TODO
\end{itemize}

\paragraph{Casi d'uso}
\begin{enumerate}
	\item VisualizzaCatalogo % RF01, RF06
	\item AggiungiProdotto % RF02
	\item CercaProdotto % RF18
	\item ModificaProdotto % RF03
	\item EliminaProdotto % RF04
	\item RegistraUtente % RF05
	\item CreaOrdine % RF07, RF09, RF17
	\item GeneraOrdineAcquisto % RF10
	\item VisualizzaOrdiniAcquisto % RF11
	\item RegistraConsegnaOrdineAcquisto % RF12
	\item GeneraReport % RF13
	\item VisualizzaOrdiniFarmacia % RF14
	\item RitiroOrdine % RF15
	\item VisualizzaOrdiniCliente % RF16
\end{enumerate}

\paragraph{Casi d'uso di inclusione}
\begin{enumerate}
	\item CercaProdotto
\end{enumerate}

\paragraph{Casi d'uso di estensione}
\begin{enumerate}
	\item GeneraOrdineAcquisto % RF10
\end{enumerate}

\begin{tblr}{
		colspec = lllll,
		hlines,
		row{1} = {font=\bfseries}
	}
	Caso d'uso & Attori primari & {Attori \\ secondari} & Incl. / Ext. & Requisito \\
	VisualizzaCatalogo & {Cliente / \\ Farmacista} & - & - & {\Req{rf}{01} \\ \Req{rf}{06}} \\
	AggiungiProdotto & Farmacista & - & - & \Req{rf}{02} \\
	CercaProdotto & Cliente & - & - & \Req{rf}{18} \\
	ModificaProdotto & Farmacista & - & {Include \\ CercaProdotto} & \Req{rf}{03} \\
	EliminaProdotto & Farmacista & - & {Include \\ CercaProdotto} & \Req{rf}{04} \\
	RegistraUtente & {Cliente \\ non registrato} & - & - & \Req{rf}{05} \\
	CreaOrdine & Cliente & - & {Include \\ CercaProdotto} & {\Req{rf}{07} \\ \Req{rf}{09} \\ \Req{rf}{17}} \\
	GeneraOrdineAcquisto & Cliente & - & Incluso in CreaOrdine & \Req{rf}{10} \\
	VisualizzaOrdiniAcquisto & Farmacista & - & - & \Req{rf}{11} \\
	RegistraConsegnaOrdineAcquisto & Farmacista & - & {Include \\ VisualizzaOrdiniAcquisto} & \Req{rf}{12} \\
	GeneraReport & Direttore & - & - & \Req{rf}{13} \\
	VisualizzaOrdiniFarmacia & Farmacista & - & - & \Req{rf}{14} \\
	RitiroOrdine & Cliente & Farmacista & {Include \\ VisualizzaOrdiniFarmacia} & \Req{rf}{15} \\
	VisualizzaOrdiniCliente & Cliente & - & - & \Req{rf}{16} \\

\end{tblr}

\section{Scenari}

% RegistraUtente
\begin{table}[!hbp]
	\centering
	\begin{scenery}{colspec=lX}
		Caso d'uso: & RegistraUtente \\
		Attore primario & Cliente non registrato \\
		Attore secondario & Nessuno \\
		Descrizione & Un utente si registra al sistema \\
		Pre-condizioni & - \\
		Sequenza di eventi principale &
			\begin{enumerate}
				\item Il cliente richiede al sistema di registrarlo
				\item Il sistema richiede al cliente i dati necessari per la registrazione
				\item Il cliente inserisce le informazioni richieste
				\item Il sistema valida il contenuto dei dati inseriti
				\item Se il controllo ha esito positivo
				\begin{enumerate}[label*=\arabic*.]
					\item Il sistema registra il cliente
				\end{enumerate}
				\item Altrimenti
				\begin{enumerate}[label*=\arabic*.]
					\item Il sistema mostra un messaggio di errore
				\end{enumerate}
			\end{enumerate} \\
		Post-condizioni & Il cliente è correttamente registrato nel sistema \\
		Casi d'uso correlati & Nessuno \\
		Sequenza di eventi alternativa & -
	\end{scenery}
\end{table}

% VisualizzaCatalogo
\begin{table}[!hbp]
	\centering
	\begin{scenery}{colspec=lX}
		Caso d'uso: & VisualizzaCatalogo \\
		Attore primario & Cliente o Farmacista \\
		Attore secondario & Nessuno \\
		Descrizione & Un cliente o un farmacista visualizzano il catalogo della farmacia \\
		Pre-condizioni & Aver effettuato l'accesso al sistema \\
		Sequenza di eventi principale &
			\begin{enumerate}
				\item Viene richiesta la visualizzazione del catalogo
				\item Il sistema mostra il catalogo della farmacia
			\end{enumerate} \\
		Post-condizioni & - \\
		Casi d'uso correlati & Nessuno \\
		Sequenza di eventi alternativa & -
	\end{scenery}
\end{table}

% AggiungiProdotto
\begin{table}[!hbp]
	\centering
	\begin{scenery}{colspec=lX}
	Caso d'uso: & AggiungiProdotto \\
	Attore primario & Farmacista \\
	Attore secondario & Nessuno \\
	Descrizione & Un farmacista aggiunge un nuovo farmaco al catalogo della farmacia \\
	Pre-condizioni & - \\
	Sequenza di eventi principale &
		\begin{enumerate}
			\item Il farmacista richiede al sistema di inserire un nuovo farmaco nel catalogo
			\item Il sistema richiede al farmacista le informazioni riguardanti il farmaco
			\item Il farmacista inserisce i dati richiesti dal sistema
			\item Il sistema valida il contenuto dei dati inseriti
			\item Se il controllo ha successo
			\begin{enumerate}[label*=\arabic*.]
				\item Il sistema aggiunge il farmaco al catalogo
			\end{enumerate}
			\item Altrimenti
			\begin{enumerate}[label*=\arabic*.]
				\item Il sistema mostra un messaggio di errore
			\end{enumerate}
		\end{enumerate} \\
	Post-condizioni & Il farmaco è aggiunto al catalogo \\
	Casi d'uso correlati & Nessuno \\
	Sequenza di eventi alternativa & -
	\end{scenery}
\end{table}

% CercaProdotto
\begin{table}[!hbp]
	\centering
	\begin{scenery}{colspec=lX}
	Caso d'uso: & CercaProdotto \\
	Attore primario & Cliente \\
	Attore secondario & Nessuno \\
	Descrizione & Il cliente cerca un prodotto all'interno del catalogo \\
	Pre-condizioni & - \\
	Sequenza di eventi principale &
		\begin{enumerate}
			\item Il cliente richiede al sistema di cercare un prodotto nel catalogo
			\item Il sistema richiede al cliente i parametri di ricerca
			\item Il sistema mostra il farmaco ricercato
		\end{enumerate} \\
	Post-condizioni & - \\
	Casi d'uso correlati & Nessuno \\
	Sequenza di eventi alternativa & -
	\end{scenery}
\end{table}

% ModificaProdotto
\begin{table}[!hbp]
	\centering
	\begin{scenery}{colspec=lX}
	Caso d'uso: & ModificaProdotto \\
	Attore primario & Farmacista \\
	Attore secondario & Nessuno \\
	Descrizione & Un farmacista modifica un farmaco presente nel catalogo della farmacia \\
	Pre-condizioni & - \\
	Sequenza di eventi principale &
		\begin{enumerate}
			\item Il farmacista richiede al sistema di modificare un farmaco nel catalogo
			\item \textit{include} (CercaProdotto)
			\item Il sistema mostra i dati del prodotto richiesto
			\item Il farmacista modifica le informazioni del prodotto
		\end{enumerate} \\
	Post-condizioni & I dati del farmaco sono stati modificati \\
	Casi d'uso correlati & Nessuno \\
	Sequenza di eventi alternativa & -
	\end{scenery}
\end{table}

% EliminaProdotto
\begin{table}[!hbp]
	\centering
	\begin{scenery}{colspec=lX}
		Caso d'uso: & EliminaProdotto \\
		Attore primario & Farmacista \\
		Attore secondario & Nessuno \\
		Descrizione & Un farmacista elimina un farmaco presente nel catalogo della farmacia \\
		Pre-condizioni & - \\
		Sequenza di eventi principale &
			\begin{enumerate}
				\item Il farmacista richiede al sistema di eliminare un farmaco nel catalogo
				\item \textit{include} (CercaProdotto)
				\item Il sistema mostra i dati del prodotto richiesto
				\item Il farmacista conferma la rimozione del prodotto
				\item Il sistema elimina il prodotto dal catalogo
			\end{enumerate} \\
		Post-condizioni & Il farmaco è eliminato dal catalogo \\
		Casi d'uso correlati & Nessuno \\
		Sequenza di eventi alternativa & -
	\end{scenery}
\end{table}

% VisualizzaOrdiniAcquisto
\begin{table}[!hbp]
	\centering
	\begin{scenery}{colspec=lX}
		Caso d'uso: & VisualizzaOrdiniAcquisto \\
		Attore primario & Farmacista \\
		Attore secondario & Nessuno \\
		Descrizione & Un farmacista visualizza l'elenco degli ordini d'acquisto della farmacia \\
		Pre-condizioni & - \\
		Sequenza di eventi principale &
			\begin{enumerate}
				\item Il farmacista richiede al sistema di visualizzare gli ordini d'acquisto
				\item Il sistema mostra l'elenco degli ordini d'acquisto
			\end{enumerate} \\
		Post-condizioni & L'elenco degli ordini di acquisto è stato mostrato a video \\
		Casi d'uso correlati & Nessuno \\
		Sequenza di eventi alternativa & -
	\end{scenery}
\end{table}

% RegistraConsegnaOrdiniAcquisto
\begin{table}[!hbp]
	\centering
	\begin{scenery}{colspec=lX}
		Caso d'uso: & RegistraConsegnaOrdiniAcquisto \\
		Attore primario & Farmacista \\
		Attore secondario & Nessuno \\
		Descrizione & Un farmacista registra l'avvenuta consegna di un ordine d'acquisto \\
		Pre-condizioni & - \\
		Sequenza di eventi principale &
			\begin{enumerate}
				\item Il farmacista richiede al sistema di visualizzare gli ordini d'acquisto
				\item \textit{include} (VisualizzaOrdiniAcquisto)
				\item Il farmacista registra l'avvenuta consegna della fornitura di interesse
				\item Il sistema aggiorna le scorte dei farmaci contenuti nella fornitura
			\end{enumerate} \\
		Post-condizioni & La consegna dell'ordine di acquisto è registrata e le scorte sono aggiornate \\
		Casi d'uso correlati & Nessuno \\
		Sequenza di eventi alternativa & -
	\end{scenery}
\end{table}

% VisualizzaOrdiniFarmacia
\begin{table}[!hbp]
	\centering
	\begin{scenery}{colspec=lX}
		Caso d'uso: & VisualizzaOrdiniFarmacia \\
		Attore primario & Farmacista \\
		Attore secondario & Nessuno \\
		Descrizione & Un farmacista visualizza l'elenco degli ordini effettuati dai clienti \\
		Pre-condizioni & - \\
		Sequenza di eventi principale &
			\begin{enumerate}
				\item Il farmacista richiede al sistema di visualizzare gli ordini dei clienti
				\item Il sistema mostra l'elenco degli ordini dei clienti
			\end{enumerate} \\
		Post-condizioni & L'elenco degli ordini dei clienti è mostrato a video \\
		Casi d'uso correlati & Nessuno \\
		Sequenza di eventi alternativa & -
	\end{scenery}
\end{table}

% RitiroOrdine
\begin{table}[!hbp]
	\centering
	\begin{scenery}{colspec=lX}
		Caso d'uso: & RitiroOrdine \\
		Attore primario & Cliente \\
		Attore secondario & Farmacista \\
		Descrizione & Un cliente ritira l'ordine effettuato online \\
		Pre-condizioni & Esiste l'ordine nel sistema \\
		Sequenza di eventi principale &
			\begin{enumerate}
				\item Il cliente arriva in farmacia e richiede il ritiro di un ordine mostrando la ricevuta
				\item \textit{include} (VisualizzaOrdiniFarmacia)
				\item Il farmacista richiede al sistema di modificare lo stato dell'ordine
			\end{enumerate} \\
		Post-condizioni & Lo stato dell'ordine è stato correttamente modificato \\
		Casi d'uso correlati & Nessuno \\
		Sequenza di eventi alternativa & -
	\end{scenery}
\end{table}

% VisualizzaOrdiniCliente
\begin{table}[!hbp]
	\centering
	\begin{scenery}{colspec=lX}
		Caso d'uso: & VisualizzaOrdiniCliente \\
		Attore primario & Cliente \\
		Attore secondario & - \\
		Descrizione & Un cliente visualizza lo storico dei suoi ordini \\
		Pre-condizioni & Il cliente è autenticato \\
		Sequenza di eventi principale &
			\begin{enumerate}
				\item Il cliente richiede al sistema di visualizzare lo storico dei suoi ordini
				\item Il sistema mostra lo storico degli ordini
			\end{enumerate} \\
		Post-condizioni & Viene mostrato lo storico degli ordini del cliente \\
		Casi d'uso correlati & Nessuno \\
		Sequenza di eventi alternativa & -
	\end{scenery}
\end{table}

% CreaOrdine
\begin{table}[!hbp]
	\centering
	\begin{scenery}{colspec=lX}
		Caso d'uso: & CreaOrdine \\
		Attore primario & Cliente \\
		Attore secondario & - \\
		Descrizione & Un cliente genera un ordine contenente farmaci presenti in catalogo \\
		Pre-condizioni & Il cliente è autenticato \\
		Sequenza di eventi principale &
			\begin{enumerate}
				\item Il cliente richiede al sistema di creare un ordine
				\item Finché il cliente non termina l'inserimento
				\begin{enumerate}[label*=\arabic*.]
					\item Il sistema richiede al cliente i criteri di ricerca
					\item \textit{include} (CercaProdotto)
					\item Se viene richiesto un farmaco non da banco, il sistema chiede conferma del possesso della prescrizione
					% \item Se il farmaco è da prescrizione, il sistema verifica che il cliente ne sia in possesso
					\item Il sistema richiede al cliente quante copie del prodotto aggiungere all'ordine
					\item Il cliente seleziona la quantità di farmaco desiderata
				\end{enumerate}
				\item Il sistema mostra al cliente il resoconto dell'ordine e l'importo totale
				\item Se il cliente conferma l'acquisto
				\begin{enumerate}[label*=\arabic*.]
					% assumiamo che le scorte siano ok
					\item Il sistema verifica che le scorte siano sufficienti
					\item Il sistema crea l'ordine con i farmaci inseriti e aggiorna le scorte
					\item Il sistema genera una ricevuta per il cliente
					\item \textit{punto di estensione}: GeneraOrdineAcquisto
				\end{enumerate}
				\item Altrimenti
				\begin{enumerate}[label*=\arabic*.]
					\item Il sistema elimina l'ordine
				\end{enumerate}
			\end{enumerate} \\
		Post-condizioni & È stato correttamente generato un ordine \\
		Casi d'uso correlati & Nessuno \\
		Sequenza di eventi alternativa &
			\begin{enumerate}
				\item Al punto 2.3, il sistema mostra un messaggio di errore se il cliente non è in possesso della prescrizione
				\begin{enumerate}[label*=\arabic*.]
					\item L'ordine viene annullato
				\end{enumerate}
				\item Al punto 4.1, il sistema rileva che le scorte non sono sufficienti
					\begin{enumerate}[label*=\arabic*.]
						\item L'ordine viene annullato
					\end{enumerate}
			\end{enumerate} \\
	\end{scenery}
\end{table}

% GeneraOrdineAcquisto
\begin{table}[!hbp]
	\centering
	\begin{scenery}{colspec=lX}
		Caso d'uso d'estensione: & GeneraOrdineAcquisto \\
		Attore primario & Cliente \\
		Attore secondario & - \\
		Descrizione & Il sistema genera un ordine di fornitura \\
		Pre-condizioni & Le scorte di uno o più prodotti sono terminate \\
		Sequenza di eventi principale &
			\begin{enumerate}
				\item Per ogni farmaco senza scorte
				\begin{enumerate}[label*=\arabic*.]
					\item Il sistema aggiunge il farmaco all'ordine d'acquisto con una quantità di default
				\end{enumerate}
				\item Il sistema crea l'ordine d'acquisto
			\end{enumerate} \\
		Post-condizioni & Viene generato un nuovo ordine d'acquisto \\
		Casi d'uso correlati & CreaOrdine \\
		Sequenza di eventi alternativa & -
	\end{scenery}
\end{table}

% TODO GeneraReport
\begin{table}[!hbp]
	\centering
	\begin{scenery}{colspec=lX}
		Caso d'uso: & GeneraReport \\
		Attore primario & Direttore \\
		Attore secondario & - \\
		Descrizione & Il Direttore della farmacia genera un report \\
		Pre-condizioni & - \\
		Sequenza di eventi principale &
			\begin{enumerate}
				\item Il Direttore richiede al sistema di generare un report
				\item Il sistema richiede al Direttore di inserire un intervallo di date
				\item Il Direttore inserisce un intervallo di date
				\item Il sistema genera e mostra il report
			\end{enumerate} \\
		Post-condizioni & Viene generato un nuovo report \\
		Casi d'uso correlati & Nessuno \\
		Sequenza di eventi alternativa & -
	\end{scenery}
\end{table}
